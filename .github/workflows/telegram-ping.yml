name: Telegram Ping

on:
  workflow_dispatch: {}        # hiện nút Run
  push:
    branches: [ main ]         # commit file này cũng tự chạy
    paths:
      - ".github/workflows/telegram-ping.yml"

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Show endpoints
        run: |
          echo "GET  https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/getMe"
          echo "POST https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage"

      - name: 1) getMe (check token)
        run: |
          set -euxo pipefail
          curl -sS "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/getMe" | tee /tmp/getme.json
          echo "::notice::getMe: $(cat /tmp/getme.json)"

      - name: 2) sendMessage (test chat_id)
        run: |
          set -euxo pipefail
          curl -sS -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.CHAT_ID }}" \
            -d text="Ping từ GitHub Actions ✅ $(date -u +'%Y-%m-%d %H:%M:%S UTC')" \
            -d disable_web_page_preview=true | tee /tmp/ping.json
          echo "::notice::sendMessage: $(cat /tmp/ping.json)"
